"use strict";(self.webpackChunkdocusauruns_ts=self.webpackChunkdocusauruns_ts||[]).push([[94510],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(n),h=r,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||i;return n?a.createElement(m,l(l({ref:t},c),{},{components:n})):a.createElement(m,l({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},28872:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const i={title:"Wrappers, Clients and Inconvenient Singletons...",date:"2017-12-12",authors:"paul",tags:["blog"],coverImage:"braincloud-client-api-architecture-overview.png"},l=void 0,o={permalink:"/braincloud-apiref/blog/2017/12/12/wrappers-clients-and-inconvenient-singletons",editUrl:"https://github.com/getbraincloud/braincloud-apiref/tree/main/blog/2017-12-12-wrappers-clients-and-inconvenient-singletons/index.md",source:"@site/blog/2017-12-12-wrappers-clients-and-inconvenient-singletons/index.md",title:"Wrappers, Clients and Inconvenient Singletons...",description:"With release 3.6.5, brainCloud is breaking away from the singletons that were previously a key aspect of our client libraries.",date:"2017-12-12T00:00:00.000Z",formattedDate:"December 12, 2017",tags:[{label:"blog",permalink:"/braincloud-apiref/blog/tags/blog"}],readingTime:4.77,hasTruncateMarker:!1,authors:[{name:"Paul Winterhalder",title:"brainCloud product owner",url:"https://github.com/winterhalder",imageURL:"https://github.com/winterhalder.png",key:"paul"}],frontMatter:{title:"Wrappers, Clients and Inconvenient Singletons...",date:"2017-12-12",authors:"paul",tags:["blog"],coverImage:"braincloud-client-api-architecture-overview.png"},prevItem:{title:"brainCloud 4 Billing Plans",permalink:"/braincloud-apiref/blog/2019/05/18/braincloud-4-billing-plans"},nextItem:{title:"Introducing Global Tournaments",permalink:"/braincloud-apiref/blog/2017/01/30/introducing-global-tournaments"}},s={authorsImageUrls:[void 0]},p=[{value:"Background",id:"background",level:2},{value:"The fix",id:"the-fix",level:2},{value:"The Changes",id:"the-changes",level:2},{value:"Legacy Singleton Mode",id:"legacy-singleton-mode",level:2},{value:"Conclusion",id:"conclusion",level:2}],c={toc:p};function u(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"With release 3.6.5, brainCloud is breaking away from the singletons that were previously a key aspect of our client libraries."),(0,r.kt)("p",null,"We thought we'd take a moment to discuss the pros and cons of the design, and explain where and why we are going a different route."),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"To start, lets review the purpose and design of the client library."),(0,r.kt)("p",null,"The goal of the client library is to ",(0,r.kt)("em",{parentName:"p"},"simplify development of brainCloud-based applications"),". It does this by:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"providing local implementation of brainCloud client calls (instead of forcing the client app to use Raw REST calls)"),(0,r.kt)("li",{parentName:"ul"},"automating communications with the server (bundling of messages for efficiency, packet security, and more)"),(0,r.kt)("li",{parentName:"ul"},"performing standard error handling")),(0,r.kt)("p",null,"The library is actually organized into two major components:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the brainCloud Client Library - a pure, platform-independent wrapper of the brainCloud client-server protocol"),(0,r.kt)("li",{parentName:"ul"},"the brainCloud Wrapper - simplifies aspects of the API (especially authentication) by incorporating more client-side functionality, like saving and restoring anonymousIds and profileIds.")),(0,r.kt)("p",null,"Use of the client library is required by apps. Use of the wrapper is highly recommended, but optional.\xa0",(0,r.kt)("em",{parentName:"p"},"Note - originally we only had the client library. The wrapper was added later as an aid to app developers.")," "),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Delving deeper into the design, you can see that the client object maintains a list of services and internal components that work together to provide the client functionality. The wrapper on the other hand is quite simple, and merely adds an additional simplification layer to the API."),(0,r.kt)("p",null,(0,r.kt)("a",{target:"_blank",href:n(602).Z},(0,r.kt)("img",{src:n(90897).Z,width:"661",height:"541"}))),(0,r.kt)("p",null,"Of significance here is the use of singletons. There are two singletons in play - one for the client, and one for the wrapper. Not only are the singletons used as the reference from the client to the wrapper and/or client library objects - but they are also used for communications between BrainCloudWrapper and BrainCloudClient."),(0,r.kt)("p",null,"In hindsight, although our intentions were good - this usage of singletons was a mistake."),(0,r.kt)("p",null,"The cons (as we now see them) are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Complicates the client code (calling the static class methods to retrieve a reference to the wrapper and or client object is more painful than using a direct global of some sort)"),(0,r.kt)("li",{parentName:"ul"},"Complicates the documented code examples"),(0,r.kt)("li",{parentName:"ul"},"Restricts a client to have one-and-only-one connection to the brainCloud server\xa0","[ ",(0,r.kt)("em",{parentName:"li"},"this is a crippling restriction for some use cases - couch co-op anyone?"),"\xa0]")),(0,r.kt)("h2",{id:"the-fix"},"The fix"),(0,r.kt)("p",null,"And so, we are fixing this."),(0,r.kt)("p",null,(0,r.kt)("a",{target:"_blank",href:n(45674).Z},(0,r.kt)("img",{src:n(88732).Z,width:"369",height:"419"}))),(0,r.kt)("p",null,"The changes to the new client libraries are three-fold:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"BrainCloudWrapper"),"\xa0objects now have their own reference to their associated ",(0,r.kt)("inlineCode",{parentName:"li"},"BrainCloudClient"),"\xa0companions"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"BrainCloudWrapper"),"\xa0objects also now provide direct methods for accessing the client services:\xa0you no longer have to call ",(0,r.kt)("em",{parentName:"li"},"wrapper\xa0\u2192 client\xa0\u2192 service\xa0\u2192 operation"),", instead it is simply ",(0,r.kt)("em",{parentName:"li"},"wrapper\xa0\u2192 service\xa0\u2192 operation"))),(0,r.kt)("p",null,"The result is that instead of your client code looking like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"BrainCloudWrapper.Instance.GetBC().LeaderboardService.ListAllLeaderboards( ApiSuccess, ApiError);")),(0,r.kt)("p",null,"It can look like this:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"_bc.LeaderboardService.ListAllLeaderboards( ApiSuccess, ApiError);")),(0,r.kt)("h2",{id:"the-changes"},"The Changes"),(0,r.kt)("p",null,"So - more flexibility and clearer code? What's the catch?"),(0,r.kt)("p",null,"The catch is that you need to make a few changes to your client to get this goodness. For new apps it's no big deal at all - this could be a pain for existing apps though, so we are still including a legacy singleton mode in the client libraries - but that needs to be specifically enabled."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Update: Legacy Singleton Mode has been removed from brainCloud client libraries beginning with 4.0."))," "),(0,r.kt)("p",null,"Here are the steps to getting your app working using the updated libraries"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Grab the latest brainCloud client library from the portal via the\xa0",(0,r.kt)("strong",{parentName:"li"},"Team | Client Libs")," page."),(0,r.kt)("li",{parentName:"ol"},"Create an instance of\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"BrainCloudWrapper")," and save it to a global accessible throughout your client app. In our documentation examples we use\xa0","_","bc, but it can be anything"),(0,r.kt)("li",{parentName:"ol"},"Adjust any client code to use this new reference - try searching and replacing",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},'"BrainCloudWrapper.Client."\xa0\u2192 "',"_",'bc."'),(0,r.kt)("li",{parentName:"ol"},'"BrainCloudClient.Instance."\xa0\u2192 "',"_",'bc."')))),(0,r.kt)("p",null,"And that's about it."),(0,r.kt)("p",null,"Note - you can optionally specify a ","_",(0,r.kt)("em",{parentName:"p"},"wrapperName"),"\xa0to use creating the wrapper. This name will be used as a key when storing data about the session, like the anonymousId and profileId."),(0,r.kt)("p",null,"You only need to specify the ",(0,r.kt)("em",{parentName:"p"},"_","wrapperName")," if you are implementing a client with multiple concurrent connections to the brainCloud server (to help keep the session data separate). ",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"In particular, if you are updating an existing app, do not specify a profile-name - this ensures that the user does not lose their saved profile references when they upgrade to the latest version of your app!"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"_bc = new BrainCloudWrapper(); // optionally pass in a _wrapperName\n_bc.initialize(_appId, _secret, _appVersion);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'_bc = go.AddComponent&lt;BrainCloudWrapper&gt;();\n_bc.WrapperName = "_example"; // optionally set a wrapper-name\n_bc.Init();\n')),(0,r.kt)("h2",{id:"legacy-singleton-mode"},"Legacy Singleton Mode"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Update: Legacy Singleton Mode has been removed from brainCloud client libraries beginning with 4.0."))," "),(0,r.kt)("p",null,"Want to move to the new libraries, but change as little code as possible? No worries, we have you covered. Here's what you do:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Grab the latest brainCloud client library\xa0from the portal via the\xa0",(0,r.kt)("strong",{parentName:"li"},"Team | Client Libs")," page."),(0,r.kt)("li",{parentName:"ol"},"Turn on legacy singleton mode via the ",(0,r.kt)("inlineCode",{parentName:"li"},"BrainCloudClient.EnableSingletonMode()"),"\xa0API call. Put the call in your code right before you initialize the library."),(0,r.kt)("li",{parentName:"ol"},"Unity only (and only if you were using the ",(0,r.kt)("inlineCode",{parentName:"li"},"Client"),"\xa0static class accessor): Adjust any calls to ",(0,r.kt)("inlineCode",{parentName:"li"},"BrainCloudWrapper.Client.aService().anOperation()"),"\xa0to use ",(0,r.kt)("inlineCode",{parentName:"li"},"BrainCloudWrapper.Instance.Client.aService().anOperation()"),"\xa0instead (Note the additional Instance step).")),(0,r.kt)("p",null,"The following code snippet shows how to enable singleton mode in various languages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"BrainCloudClient.EnableSingletonMode = true;  // Turn on legacy singleton mode\nBrainCloudWrapper.getInstance().initialize(_appId, _secret, _appVersion);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"BrainCloudClient.EnableSingletonMode = true;  // Turn on legacy singleton mode\nBrainCloudWrapper.getInstance().Init();\n")),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"Anyway, thats the summary of what we have changed, and why."),(0,r.kt)("p",null,"We hope you agree that the improvements to functionality and readability are worth it."),(0,r.kt)("p",null,"If you have any feedback or concerns, feel free to hit the chat link and let us know."),(0,r.kt)("p",null,"Cheers!"))}u.isMDXComponent=!0},602:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/files/braincloud-client-api-architecture-details-a91ef7c8f27f52a78ba75b808797b9c8.png"},45674:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/files/braincloud-client-api-architecture-new-3557e789930ecf9b75c70cd3f54173ba.png"},90897:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/braincloud-client-api-architecture-details-a91ef7c8f27f52a78ba75b808797b9c8.png"},88732:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/braincloud-client-api-architecture-new-3557e789930ecf9b75c70cd3f54173ba.png"}}]);